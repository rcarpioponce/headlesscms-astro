---
import { fetchPosts, type WpPostsResponse } from '../../lib/wp';
import '../../styles/global.css';
import '../../styles/index.css';
import Layout from '../../layouts/Layout.astro';
import PostCard from '../../components/PostCard.astro';
import Pagination from '../../components/Pagination.astro';

export async function getStaticPaths() {
  // Primero obtenemos la primera página para saber cuántas páginas hay
  const firstPageResponse = await fetchPosts(6, 1);
  const totalPages = firstPageResponse.totalPages;
  
  // Generamos todas las páginas
  const pages = [];
  
  for (let page = 1; page <= totalPages; page++) {
    const response = await fetchPosts(6, page);
    pages.push({
      params: { page: page.toString() },
      props: {
        postsResponse: response
      }
    });
  }
  
  return pages;
}

interface Props {
  postsResponse: WpPostsResponse;
}

const { postsResponse } = Astro.props;
const { posts, currentPage, totalPages, hasNextPage, hasPrevPage } = postsResponse;
---

<Layout 
  title={`Blog - Página ${currentPage} | Aprende cada día más`}
  description={`Explora más artículos sobre tecnología y desarrollo web. Página ${currentPage} de ${totalPages} con contenido de calidad para seguir aprendiendo.`}
>
  <div class="blog-header">
    <h1>Blog</h1>
    <p class="blog-subtitle">Descubre las últimas noticias y artículos</p>
  </div>
  
  <ul class="posts-list">
    {posts.map((post) => (
      <PostCard post={post} />
    ))}
  </ul>
  
  {totalPages > 1 && (
    <Pagination 
      currentPage={currentPage}
      totalPages={totalPages}
      hasNextPage={hasNextPage}
      hasPrevPage={hasPrevPage}
      baseUrl="/"
    />
  )}
</Layout>

<style>
.blog-header {
  text-align: center;
  margin-bottom: 3rem;
  padding: 2rem 0;
}

.blog-header h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 0.5rem;
  color: var(--text-primary);
  letter-spacing: -0.02em;
}

.blog-subtitle {
  font-size: 1.1rem;
  color: var(--text-secondary);
  margin: 0;
  font-weight: 400;
}

/* Mobile styles */
@media (max-width: 768px) {
  .blog-header {
    margin-bottom: 2rem;
    padding: 1rem 0;
  }
  
  .blog-header h1 {
    font-size: 2rem;
  }
  
  .blog-subtitle {
    font-size: 1rem;
  }
}
</style>
